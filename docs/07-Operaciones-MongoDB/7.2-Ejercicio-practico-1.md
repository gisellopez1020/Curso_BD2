# Ejercicio prÃ¡ctico 1

El objetivo de este ejercicio serÃ¡ crear una base de datos de nombre Modulo2Ejemplo1 y se deberÃ¡ crear una colecciÃ³n llamada pelÃ­culas con un esquema que incluya los siguientes campos obligatorios: **`tÃ­tulo`** (cadena de texto), **`director`** (cadena de texto), **`aÃ±o`** (entero), **`presupuesto`** (double) y **`genero`** (cadena de texto que permitirÃ¡ almacenar pelÃ­culas del tipo aventura, drama y ciencia ficciÃ³n). La base de datos deberÃ¡ permitir que las colecciones sigan un nivel de validaciÃ³n moderado, controle el error y permita la adiciÃ³n de propiedades.

Requisito adicional, una vez creada la colecciÃ³n pelÃ­culas agregue el campo opcional **`estrellas`**, el cual serÃ¡ un arreglo de documentos embebidos compuesto por los campos obligatorios **`nombre`** (cadena de texto), **`aÃ±o de nacimiento`** (entero) y **`nacionalidad`** (campo de texto). Y por Ãºltimo, el campo **`estado civil`** que deberÃ¡ ser opcional.

**Instrucciones:**

- Abrir MongoDB Compass y crear la base de datos Modulo2Ejemplo1. Para crear la base de datos usaremos la shell como se puede observar en la Figura 1.

![Abrir Shell](../../imgs/instr1.png)

**Figura 1: MongoDB Compass - Mongosh**

- Ahora usa el comando **`â€œuseâ€`** en la shell para crear la base de datos. Si la base de datos existe, permitirÃ¡ cambiar de la base de datos actual â€œtestâ€ a la que se desea trabajar. En el caso de no existir se crearÃ¡ un espacio en memoria temporal con el nombre â€œModulo2Ejemplo1â€ hasta que se realice una operaciÃ³n en ella (crear una colecciÃ³n o un documento).

![Crear Base de Datos](../../imgs/instr2.png)

**Figura 2: MongoDB Compass â€“ Base de datos Modulo2Ejemplo1**

- Luego en Hackolade, se deberÃ¡ modelar la colecciÃ³n mediante los requisitos especificados en el enunciado del problema.

![BD MÃ³dulo2Ejemplo1](../../imgs/bdModulo2Ej1.png)

**Figura 3: Base de Datos Modulo2Ejemplo1 - Hackolade**

```
db.createCollection("Peliculas", {
    "capped": false,
    "validator": {
        "$jsonSchema": {
            "bsonType": "object",
            "title": "Peliculas",
            "properties": {
                "_id": {
                    "bsonType": "objectId"
                },
                "titulo": {
                    "bsonType": "string"
                },
                "director": {
                    "bsonType": "string"
                },
                "aÃ±o": {
                    "bsonType": "int"
                },
                "presupuesto": {
                    "bsonType": "double"
                },
                "genero": {
                    "bsonType": "string",
                    "enum": [
                        "aventura",
                        "drama",
                        "ciencia ficciÃ³n "
                    ]
                }
            },
            "additionalProperties": true,
            "required": [
                "_id",
                "titulo",
                "director",
                "aÃ±o",
                "presupuesto",
                "genero"
            ]
        }
    },
    "validationLevel": "moderate",
    "validationAction": "error"
});
```

- Copiar el script de la colecciÃ³n generado en Hackolade y correrlo en MongoDB Compass.

![Correr Script](../../imgs/correrScript.png)

**Figura 4: Ejecutar Script - ColecciÃ³n PelÃ­culas**

- Ahora, se deberÃ¡ confirmar que la colecciÃ³n fue creada en la base datos. Por tanto, buscar en la consola de la shell si aparece la sentencia de respuesta **`{ ok: 1 }`**. TambiÃ©n es posible realizar esta acciÃ³n dando clic en el **`â€œshow actionsâ€`** del localhost:27017, es decir en los **`â€œâ€¦â€`** y luego en el menÃº seleccionar la opciÃ³n **`â€œResfresh databasesâ€`**. Una vez realizada esta acciÃ³n deberÃ­a aparecer la base de datos con la colecciÃ³n creada en la lista de bases de datos alojadas en el servidor.

![Actualizar Localhost](../../imgs/localhost.png)

**Figura 5: Actualizar el localhost**

- Verificar si la colecciÃ³n fue creada con Ã©xito. Seleccionar de la base de datos la colecciÃ³n y luego dar clic en la pestaÃ±a **`â€œvalidationâ€`**. AquÃ­, se podrÃ¡ observar el esquema creado, el nivel de â€œValidationâ€, etc.

![Verificar creaciÃ³n de ColecciÃ³n PelÃ­culas](../../imgs/validation.png)

**Figura 6: Verificar la CreaciÃ³n de la ColecciÃ³n PelÃ­culas**

- Ahora, use el comando collMod para agregar el campo estrellas como parte del esquema, con los campos requeridos.

```
db.runCommand({
    "collMod": "Peliculas",
    "validator": {
        "$jsonSchema": {
            "bsonType": "object",
            "title": "Peliculas",
            "properties": {
                "_id": {
                    "bsonType": "objectId"
                },
                "titulo": {
                    "bsonType": "string"
                },
                "director": {
                    "bsonType": "string"
                },
                "aÃ±o": {
                    "bsonType": "int"
                },
                "presupuesto": {
                    "bsonType": "double"
                },
                "genero": {
                    "bsonType": "string",
                    "enum": [
                        "aventura",
                        "drama",
                        "ciencia ficciÃ³n "
                    ]
                },
                "estrellas": {
                    "bsonType": "array",
                    "additionalItems": true,
                    "items": {
                        "bsonType": "object",
                        "properties": {
                            "nombre": {
                                "bsonType": "string"
                            },
                            "aÃ±oNacimiento": {
                                "bsonType": "int"
                            },
                            "nacionalidad": {
                                "bsonType": "string"
                            },
                            "estadoCivil": {
                                "bsonType": "string"
                            }
                        },
                        "additionalProperties": false,
                        "required": [
                            "nombre",
                            "aÃ±oNacimiento",
                            "nacionalidad"
                        ]
                    }
                }
            },
            "additionalProperties": true,
            "required": [
                "_id",
                "titulo",
                "director",
                "aÃ±o",
                "presupuesto",
                "genero"
            ]
        }
    },
    "validationLevel": "moderate",
    "validationAction": "error"
});
```

- Finalmente, verificar si el esquema fue actualizado de forma correcta. Para esta acciÃ³n, es necesario cerrar y volver abrir MongoDB Compass, seleccionar la colecciÃ³n pelÃ­culas de la base de datos e ir a la pestaÃ±a â€œValidationâ€.

![Verificar creaciÃ³n de ColecciÃ³n PelÃ­culas](../../imgs/actualizacion.png)

**Figura 7: Verificar la ActualizaciÃ³n de la ColecciÃ³n PelÃ­culas**

> ### ðŸ‘‰**Sigue practicando con el [Ejercicio 2](7.3-Ejercicio-practico-2.md)**
