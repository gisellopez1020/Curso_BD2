# GestiÃ³n de esquemas

En MongoDB es importante comprender las operaciones de gestiÃ³n de esquemas que tienen como tarea la creaciÃ³n y gestiÃ³n de la estructura de una base de datos. Estas operaciones hacen parte del grupo de operaciones relacionadas con la administraciÃ³n de bases de datos en MongoDB. Algunas de las operaciones que incluye la gestiÃ³n de esquemas estÃ¡n relacionadas con la creaciÃ³n y modificaciones de colecciones, definiciÃ³n y modificaciÃ³n de esquemas de documentos y la validaciÃ³n de esquemas.

En MongoDB las colecciones pueden ser creadas de forma explÃ­cita a travÃ©s del uso del mÃ©todo **`createCollection()`** o de forma directa al insertar un documento haciendo uso del mÃ©todo **`insertOne()`** o **`insertMany()`**.

A travÃ©s del mÃ©todo **`createCollection()`** se pueden crear una colecciÃ³n sin especificar caracterÃ­sticas del esquema y/o validaciÃ³n. Un ejemplo de cÃ³mo usar el comando **`createCollection()`** se presenta a continuaciÃ³n:

**Ejemplo:**

```
db.createCollection("personas")
```

TambiÃ©n, se puede emplear el mÃ©todo **`createCollection()`** para crear una colecciÃ³n con caracterÃ­sticas especÃ­ficas, por ejemplo: Limitar el tamaÃ±o de una colecciÃ³n, mediante el uso de la caracterÃ­stica **`â€œcappedâ€`**. Especificar las reglas de validaciÃ³n de los documentos mediante el uso de la opciÃ³n **`â€œvalidatorâ€`** y la opciÃ³n **`â€œ$jsonSchemaâ€`** para establecer el esquema de los documentos, las opciones de validaciÃ³n a travÃ©s del **`"additionalProperties"`** y el nivel de validaciÃ³n mediante el uso de **`"validationLevel"`**.

**Ejemplo:**

```
db.createCollection("personas", {
    "capped": false,
    "validator": {
        "$jsonSchema": {
            "bsonType": "object",
            "title": "Personas",
            "properties": {
                "_id": {
                    "bsonType": "objectId"
                },
                "nombre": {
                    "bsonType": "string"
                },
                "edad": {
                    "bsonType": "int"
                }
            },
            "additionalProperties": true,
            "required": [
                "_id",
                "nombre",
                "edad"
            ]
        }
    },
    "validationLevel": "moderate",
    "validationAction": "error"
});
```

Cuando se crear una colecciÃ³n de forma directa a travÃ©s de los mÃ©todos **`insertOne()`** e **`insertMany()`**, MongoDB crearÃ¡ de forma automÃ¡tica la colecciÃ³n y luego insertarÃ¡ el o los documentos especificados.

**Ejemplos:**

```
// Crea la colecciÃ³n personas y luego insertar un documento
db.personas.insertOne({ nombre: "AndrÃ©s", edad: 30 });

// Crea la colecciÃ³n personas y luego insertar mÃºltiples documentos
db.personas.insertMany([
    { nombre: "Clara", edad: 25 },
    { nombre: "Santiago", edad: 28 }
]);
```

Para actualizar la estructura de una colecciÃ³n una vez creada es posible emplear el comando **`collMod`**. Esta acciÃ³n solo afectarÃ¡ a los documentos nuevos o que se actualicen despuÃ©s de aplicar el cambio. En el siguiente ejemplo, se actualizarÃ¡ la colecciÃ³n personas agregando el campo **`sexo`** como obligatorio. Este campo serÃ¡ un string que podrÃ¡ solo tomar valores mujer o hombre. AdemÃ¡s, la colecciÃ³n pasarÃ¡ a tener un nivel de validaciÃ³n estricta y no permitirÃ¡ la adiciÃ³n de nuevas propiedades, mediante la modificaciÃ³n de la propiedad **`â€œadditionalPropertiesâ€`** a false.

**Ejemplo:**

```
db.runCommand({
  collMod: "personas",
  validator: {
    $jsonSchema: {
      bsonType: "object",
      title: "Personas",
      properties: {
        _id: {
          bsonType: "objectId"
        },
        nombre: {
          bsonType: "string"
        },
        edad: {
          bsonType: "int"
        },
        sexo: {
          bsonType: "string",
          enum: ["hombre", "mujer"],
          description: "'sexo' debe ser 'hombre' o 'mujer'"
        }
      },
      additionalProperties: false,
      required: [
        "_id",
        "nombre",
        "edad",
        "sexo"
      ]
    }
  },
  validationLevel: "strict",
  validationAction: "error"
});
```

En el caso que se deseen consultar todas las colecciones de una base de datos se podrÃ¡ emplear el comando **`show collections`**. Y para eliminar una colecciÃ³n por completo de la base de datos se deberÃ¡ usar el comando **`drop()`**. Este comando eliminarÃ¡ todos los documentos e Ã­ndices creados para la colecciÃ³n. Por ejemplo, si se desea eliminar la colecciÃ³n personas, se deberÃ¡ utilizar la variable **`â€œdbâ€`** para representar que la acciÃ³n sucederÃ¡ en la base de datos en la que se estÃ¡ trabajando, el nombre de la colecciÃ³n y el comando **`drop()`**. Un ejemplo de cÃ³mo usar el comando **`drop()`** se presenta a continuaciÃ³n:

**Ejemplo:**

```
db.personas.drop()
```

> ### ğŸ‘‰ **ContinÃºa con el [Ejercicio prÃ¡ctico](7.2-Ejercicio-practico-1.md)**
