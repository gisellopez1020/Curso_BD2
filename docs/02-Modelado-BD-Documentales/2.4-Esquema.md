# Esquema

Un esquema en MongoDB es un objeto JSON que permite definir la estructura de los documentos dentro de una colecci√≥n. En los esquemas, se pueden especificar los tipos de datos que tomar√°n cada uno de los campos de un documento, incluyendo tipos primitivos como cadenas y n√∫meros, as√≠ como tipos estructurales como objetos y arreglos ‚Äã[[8]](../05-Referencias/05-Referencias-Modulo-1.md#8)‚Äã. Adem√°s, los esquemas permiten establecer niveles de validaci√≥n y control para evitar errores durante la inserci√≥n de datos. Los niveles de validaci√≥n y control se pueden categorizar en: Flexible, semi flexible (Moderado) y no flexible (Estricto).

## Flexible

En MongoDB, los documentos dentro de una colecci√≥n pueden tener estructuras diferentes sin restricciones sobre los campos. Esto significa que no es obligatorio definir un esquema de validaci√≥n, ya que MongoDB permite esta flexibilidad de forma predeterminada. En el siguiente ejemplo, se presentan dos documentos de la misma colecci√≥n, donde el √∫nico campo en com√∫n es el identificador **`_id`**.

_Ejemplo de documentos:_

```
{
‚ÄØ ‚ÄØ _id: ObjectId("64f7ea6cffa6e715ea6ac2ea"),
‚ÄØ ‚ÄØ nombres: 'camila perez',
‚ÄØ ‚ÄØ edad: 21,
‚ÄØ ‚ÄØ idiomas: ['ingles', 'frances', 'aleman' ]
},

{
‚ÄØ ‚ÄØ _id: ObjectId("64f7ea6cffa6e715ea6ac2eb"),
‚ÄØ ‚ÄØ nombreCompleto: 'sandra suarez',
‚ÄØ ‚ÄØ genero: 'femenino'
}
```

Como se observa, ambos documentos tienen diferentes estructuras: el primero incluye campos como **`_nombres`**, **`edad`** e **`idiomas_`**, mientras que el segundo solo tiene **`nombreCompleto`** y **`genero`**. Esta flexibilidad es una de las ventajas de MongoDB, ya que permite almacenar datos heterog√©neos dentro de una misma colecci√≥n.

## Semi Flexible (Moderado)

Este tipo de esquema permite establecer ciertas reglas de validaci√≥n a una colecci√≥n haciendo uso de JSON Schema. A trav√©s de la definici√≥n de campos comunes que la mayor√≠a de los documentos de una colecci√≥n deben cumplir. Esto proporciona un equilibrio entre la flexibilidad de los documentos y el control sobre los datos almacenados, garantizando que ciertos campos se mantengan consistentes sin restringir totalmente la estructura.

_Ejemplo de una Colecci√≥n:_

![Colecci√≥n Personas](../../imgs/coleccion-personas.png)

**Figura 5. Colecci√≥n Personas**

Para implementar la validaci√≥n de la colecci√≥n ‚ÄúPersonas‚Äù, podemos crear el siguiente JSON Schema:

```
db.createCollection("Personas", {
    "capped": false,
    "validator": {
        "$jsonSchema": {
            "bsonType": "object",
            "title": "Personas",
            "properties": {
                "_id": {

                    "bsonType": "objectId"
                },
                "nombres": {

                    "bsonType": "string"
                },
                "edad": {

                    "bsonType": "int"
                },
                "idiomas": {
                    "bsonType": "array",
                    "additionalItems": true,
                    "items": {
                        "bsonType": "string"
                    }
                }
            },
            "additionalProperties": true,
            "required": [
                "_id",
                "nombres",
                "edad",
                "idiomas"
            ]
        }
    },
    "validationLevel": "moderate",
    "validationAction": "error"
});
```

**Explicaci√≥n:** Este JSON Schema establece que cada documento en la colecci√≥n ‚ÄúPersonas‚Äù debe incluir los campos **`_id`**, **`nombres`**, **`edad`** e **`idiomas`**, con los tipos de datos _(bsonType3)_ especificados. La propiedad **`"additionalProperties": true`**, permite que los documentos contengan otros campos adicionales. Al configurar **`"validationLevel": "moderate"`** y **`"validationAction": "error"`**, MongoDB aplicar√° una validaci√≥n moderada (es decir, define el tipo de esquema aplicado a la colecci√≥n) y mostrar√° un error si un documento no cumple con los campos obligatorios. Finalmente, la propiedad **`"capped"`**: indica que la colecci√≥n no tiene un l√≠mite m√°ximo de documentos que puede almacenar.

_Ejemplo de documentos:_

```
[
‚ÄØ {
‚ÄØ ‚ÄØ _id: ObjectId("64f7ea6cffa6e715ea6ac2ea"),
‚ÄØ ‚ÄØ nombres: ‚Äòcamila perez',
‚ÄØ ‚ÄØ edad: 21,
‚ÄØ ‚ÄØ idiomas: ['ingles', 'frances', 'aleman' ]
‚ÄØ },
‚ÄØ {
‚ÄØ ‚ÄØ _id: ObjectId("64f7ea6cffa6e715ea6ac2eb"),
‚ÄØ ‚ÄØ nombres: ‚Äòsandra suarez',
‚ÄØ ‚ÄØ edad: 19,
‚ÄØ ‚ÄØ idiomas: [ 'ingles ', 'frances' ],
‚ÄØ ‚ÄØ intereses: [ ‚Äòlectura', 'viajes' ]
‚ÄØ }
]
```

En este ejemplo, ambos documentos de la colecci√≥n incluyen los campos comunes **`nombres`**, **`edad`** e **`idiomas`**, siguiendo las reglas b√°sicas establecidas. Sin embargo, tambi√©n tienen la flexibilidad de contener otros campos, como **`intereses`**, lo que permite una estructura variada en los datos sin perder consistencia en los elementos esenciales.

## No Flexible (Estricto)

Este nivel de validaci√≥n permite establecer reglas rigurosas mediante JSON Schema que todos los documentos de una colecci√≥n deben cumplir sin excepciones. Este esquema establece restricciones similares a las de los esquemas de bases de datos relacionales, asegurando que todos los documentos mantengan una estructura uniforme.

![Colecci√≥n Veh√≠culos](../../imgs/coleccion-vehiculos.png)

**Figura 6. Colecci√≥n Vehiculos**

Para implementar la validaci√≥n de la colecci√≥n ‚ÄúVehiculos‚Äù, podemos crear el siguiente JSON Schema:

```
db.createCollection("Vehiculos", {
    "capped": false,
    "validator": {
        "$jsonSchema": {
            "bsonType": "object",
            "title": "Vehiculos",
            "properties": {
                "_id": {
                    "bsonType": "objectId"
                },
                "matricula": {
                    "bsonType": "string"
                },
                "marca": {
                    "bsonType": "string"
                },
                "tipo": {
                    "bsonType": "string",
                    "enum": [
                        "autom√≥vil",
                        "moto",
                        "cuatrimoto",
                        "bicicleta"
                    ]
                }
            },
            "additionalProperties": false,
            "required": [
                "_id",
                "matricula",
                "marca",
                "tipo"
            ]
        }
    },
    "validationLevel": "strict",
    "validationAction": "error"
});
```

**Explicaci√≥n:** Este JSON Schema establece que cada documento de la colecci√≥n ‚ÄúVehiculos‚Äù debe incluir los campos **`_id`**, **`matricula`**, **`marca`** y **`tipo`**, todos con tipos de datos espec√≠ficos definidos por **`bsonType`**. Adem√°s, el campo **`tipo`** solo puede tener uno de los valores predefinidos en el **`ENUM`**: **`"autom√≥vil"`**, **`"moto"`**, **`"cuatrimoto"`** o **`"bicicleta"`**. La propiedad **`"additionalProperties": false`**, garantiza que no se puedan agregar campos adicionales, lo que limita la estructura de los documentos a los campos especificados. Al usar **`"validationLevel": "strict"`** y **`"validationAction": "error"`**, MongoDB rechazar√° cualquier documento que no cumpla completamente con este esquema, aplicando as√≠ una validaci√≥n estricta.

_Ejemplo de documentos:_

- Documento V√°lido:

```
{
‚ÄØ ‚ÄØ _id: ObjectId("64f7ea6cffa6e715ea6ac2eb"),
‚ÄØ ‚ÄØ matricula: 'HPQ 087',
‚ÄØ ‚ÄØ marca: 'FORD',
‚ÄØ ‚ÄØ tipo: 'autom√≥vil'
}
```

Este documento cumple con el esquema definido en _Vehiculos_, ya que incluye los campos obligatorios **`_id`**, **`matricula`**, **`marca`** y **`tipo`**, y respeta los tipos de datos y las restricciones especificadas _(como el valor permitido para tipo)_.

- Documento inv√°lido

```
{
‚ÄØ ‚ÄØ _id: ObjectId("64f7ea6cffa6e715ea6ac2ef"),
‚ÄØ ‚ÄØ matricula: 'HPQ 087',
‚ÄØ ‚ÄØ marca: 'FORD',
    modelo: ' Escape H√≠brida',
‚ÄØ ‚ÄØ tipo: 'autom√≥vil'
}
```

Aunque el documento incluye los campos obligatorios (**`_id`**, **`matricula`**, **`marca`** y **`tipo`**) con los tipos y valores correctos, contiene un campo extra (**`modelo`**). Dado que en el esquema se estableci√≥ la propiedad **`"additionalProperties": false`**, cualquier campo no definido en el esquema har√° que el documento sea rechazado.

## Ve al siguiente tema: [Modelado de Datos y Relaciones üóÉÔ∏è‚û°Ô∏è](/docs/03-Modelado-de-Datos-Relaciones-MongoDB/3.1-Modelado-de-Datos-y-Relaciones-en-MongoDB.md)
